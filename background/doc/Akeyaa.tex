\documentclass[12pt]{article}
\input{preamble}

\newcommand{\version}{Draft: 17 May 2020}

\lhead{\scriptsize Barnes \& Soule}
\chead{\scriptsize}
\rhead{\scriptsize \thepage}

\lfoot{\scriptsize Akeyaa}
\cfoot{\scriptsize}
\rfoot{\scriptsize \version}

\usepackage{color}
\definecolor{red}{RGB}{255,0,0}

\usepackage{xcolor}
\usepackage{pbox}
\usepackage{tcolorbox}
\usepackage{colortbl}

\newcommand{\Oneka}{{\textsf{O\raisebox{-0.3ex}{n}\raisebox{0.3ex}{e}\raisebox{-0.3ex}{k}a}}}


%==============================================================================
\begin{document}
%==============================================================================

%==============================================================================
% Title block information
%==============================================================================
\title{Inferring Local Flow Directions using the\\Conic Discharge Potential Model}
\author{
Dr. Randal J. Barnes\\
Department of Civil, Environmental, and Geo- Engineering\\
University of Minnesota
\and
Richard Soule\\
Source Water Protection\\
Minnesota Department of Health\\
}
\date{\version}
\maketitle
\thispagestyle{plain}


%==============================================================================
\section{INTRODUCTION}
%==============================================================================
Determining the likely groundwater flow direction from water level data is a common practical problem. Since the advent of the personal computer, this problem domain has been well trodden \citep[e.g.][]{Kelly1989}. ``Two points determine a line,'' and ``three points determine a plane'' are common mantras in introductory geometry. Given a plane, we have a dip and dip direction: a lesson from structural geology. \citet{Pinder1981} furnishes the details of the {\em three-point problem} for computing the hydraulic head gradient based on these principles. Introductory hydrogeology classes commonly include a method to determine the hydraulic head gradient from three head measurements \citep[e.g.][Section 4.12]{Fetter94}.

The purely geometric perspective embraced by most authors ignores the inherent uncertainty in all head measurements. Piezometric data are subject to many sources of perturbations, deviations, and outright errors; for example, uncertain collar locations, imprecise collar elevations, error-prone depth measurements, fluctuating pumping influences, unquantified seasonal effects, climatic variations, and changing usage of groundwater resources. This list is not exhaustive. We propose that head measurements must be understood as stochastic quantities. Furthermore, errors and fluctuations in the head measurements will have significant impacts on the inferred flow directions \citep[e.g.][]{Devlin2007}.

The approach outlined in this paper (project name: {\em Akeyaa}) uses the \Oneka-type conic discharge potential model\footnote{See Appendix~\ref{7.1}.} to infer local flow directions from noisy head measurements. The statistical inference provides a probability distribution for local flow directions. As will be shown, we can infer flow directions without knowing the base elevation, the aquifer thickness, or the hydraulic conductivity. All we need is lots of data.


%==============================================================================
\section{OUR MODEL}
%==============================================================================
%--------------------------------------
\subsection{Coordinates and Notation}\label{2.1}
%--------------------------------------
We introduce a Cartesian coordinate system $(x,y,z)$, where $x~[m]$ and $y~[m]$ are the horizontal coordinates and $z~[m]$ is the vertical coordinate. The origin of the coordinate system is arbitrary.

%--------------------------------------
\subsection{Aquifer Model}\label{2.2}
%--------------------------------------
Our aquifer model embraces the following simplifications:
%
\begin{itemize}
    \item a single layer,
    \item fully confined,
    \item homogeneous,
    \item horizontally isotropic,
    \item on a flat-lying base.
\end{itemize}
%
The base elevation, $z_b~[m]$, aquifer thickness, $H~[m]$, horizontal hydraulic conductivity, $k~[m/d]$, and vertical hydraulic conductivity, $k_v~[m/d]$, characterize such an aquifer for our purposes.

%--------------------------------------
\subsection{Discharge and Discharge Potential}\label{2.3}
%--------------------------------------
We denote the piezometric head in the aquifer by $\phi(x,y,z)~[m]$, and the two horizontal components of the specific discharge vector by $q_x(x,y,z)~[m/d]$ and $q_y(x,y,z)~[m/d]$.

We define the components of the discharge vector, $Q_x(x,y)~[m^2/d]$ and $Q_y(x,y)~[m^2/d]$, as the vertically integrated specific discharge.
%
\begin{equation}\label{2.4}
    Q_x(x,y) = \int_{z_b}^{z_b+H} q_x(x,y,z) dz
	\qquad \qquad
    Q_y(x,y) = \int_{z_b}^{z_b+H} q_y(x,y,z) dz
\end{equation}
%
Following \citet[p. 77-78]{Bear79} and \citet{Strack06}, we integrate \eqref{2.4} using Leibnitz's rule, apply Darcy's law, and obtain the following expressions:
%
\begin{equation}\label{2.5}
    Q_x(x,y) = -\pderiv{\Phi}{x}
    \qquad\qquad
    Q_y(x,y) = -\pderiv{\Phi}{y}
\end{equation}
%
where the discharge potential, $\Phi(x,y)~[m^3/d]$, is given by
%
\begin{equation}\label{2.6}
    \Phi(x,y) = kH\bar{\phi}(x,y)
\end{equation}
%
with the vertically averaged piezometric head, $\bar{\phi}(x,y)~[m]$, defined by
%
\begin{equation}\label{2.7}
    \bar{\phi}(x,y) = \frac{1}{H} \int_{z_b}^{z_b+H} \phi(x,y,z) dz
\end{equation}
%
We observe, following \citet{Youngs66b}, that \eqref{2.6} is a valid discharge potential even when the hydraulic conductivity is vertically anisotropic.

%------------------------------------------------
\subsection{Regional Flow Model}
%------------------------------------------------
The \Oneka-type regional flow model captures two features: regional uniform recharge, and regional uniform flow.  The result form for the discharge potential is a second-order polynomial in $x$ and $y$:
%
\begin{equation} \label{2.8}
    \Phi(x,y) = Ax^2 + By^2 + Cxy + Dx + Ey + F
\end{equation}
%
where $A$, $B$, $C$, $D$, $E$, and $F$ are model parameters\footnote{See Appendix~\ref{7.1} for more details.}. All conic sections can be represented by the general form of \eqref{2.8}, thus the name ``conic discharge potential''.

The components of the associated discharge vector, $(Q_x,Q_y)~[m^2/d]$, are
%
\begin{equation} \label{2.9}
    -Q_x(x,y) = \pderiv{\Phi}{x} = 2Ax + Cy + D
\end{equation}
%
\begin{equation} \label{2.10}
    -Q_y(x,y) = \pderiv{\Phi}{y} = 2By + Cx + E
\end{equation}

The resulting flow direction\footnote{In this note we define the ``flow direction'' as the direction from which the flow originates. This is consistent with the usage of the term in atmospheric physics and meteorology; e.g. a ``north wind'' blows from the north toward the south.  This definition is useful in well-head protection because it helps identify the source areas.}, $\alpha(x,y)~[rad]$, is computed using the standard four quadrant arctangent\footnote{See, for example, \cite{wiki:atan2}.} function as
%
\begin{align}\label{2.11}
    \alpha(x,y)
    &= \text{\tt atan2}\left(-Q_y(x,y), -Q_x(x,y)\right) \nonumber\\[8pt]
    &= \text{\tt atan2}\left((2By + Cx + E), (2Ax + Cy + D)\right)
\end{align}

The net recharge, $N~[m/d]$, is given by the divergence of the gradient of the discharge potential.
%
\begin{equation}\label{2.12}
    N = -\nabla^2 \Phi(x,y) = -2(A+B)
\end{equation}
%
Note that $N$ is not a function of location in this model.


%==============================================================================
\section{MEASUREMENTS AND NOISE}
%==============================================================================
We consider a set of $N$ observed piezometric heads:
%
\begin{equation}\label{3.1}
	\left\{ (x_1,y_1,\hat{\phi}_1), (x_2,y_2,\hat{\phi}_N), \ldots, (x_N,y_N,\hat{\phi}_N) \right\}
\end{equation}
%
where $\hat{\phi}_n$ denotes the measured head at location $(x_n,y_n)$, for $n = 1, 2, \ldots, N$.

Head measurements contain errors and deviations.  We model the relationship between the measured head at location $(x_n, y_n)$ and the vertically averaged head at the same location using
%
\begin{equation}\label{3.2}
	\hat{\phi}_n = \bar{\phi}(x_n, y_n) + \epsilon_n
\end{equation}
%
for $n = 1, 2, \ldots, N$, where $\epsilon_n~[n]$ denotes the net error and deviation (noise) associated with the $n$'th head measurement.

The sources of the errors and deviations of head measurements are legion.  Typically, these sources are well-modeled as statistically independent and additive.  As such we will embrace the promise of the {\em Central Limit Theorem}\footnote{See, for example, \citet{wiki:clt}.} and model the $\epsilon_n$ as independent, Normal random variables, with $0$ mean and standard deviation $\sigma_n$,
%
\begin{equation}\label{3.3}
    \epsilon_n \Rightarrow \text{Normal}(0, \sigma_n)
\end{equation}
%
for $n=1,2,\ldots,N$.

The measurement standard deviations are known based upon physical characteristics of the wells and the measurements.  Note, we are assuming that the measurements are unbiased, but we are not assuming that they are homoscedastic. For example, older measurements may have larger standard deviations than newer measurements.


%==============================================================================
\section{FITTING THE MODEL}
%==============================================================================
%------------------------------------------------------------------------------
\subsection{Matching the Measured Heads}
%------------------------------------------------------------------------------
The conic discharge potential model has six free parameters, $A$ through $F$.  Values for these parameters are inferred using an inverse modelling approach: we select the parameters to best fit the measured piezometric heads.

We can divide \eqref{2.6} by $kH$, solve for $\bar{\phi}(x,y)$, and substitute the result into \eqref{3.2}. These steps yield
%
\begin{equation}\label{4.1}
    \hat{\phi}_n = \frac{\Phi(x_n, y_n)}{kH} + \epsilon_n
\end{equation}
%
Substituting \eqref{2.8} into \eqref{4.1} we arrive at
%
\begin{equation} \label{4.2}
    \hat{\phi}_n = a x_n^2 + b y_n^2 + c x_n y_n + d x_n + e y_n + f + \epsilon_n
\end{equation}
%
for $n = 1, 2, \ldots, N$, where $a = \frac{A}{kH}$, $b = \frac{B}{kH}$, $ \ldots$, and $f = \frac{F}{kH}$.

%------------------------------------------------------------------------------
\subsection{Matrix Representation}
%------------------------------------------------------------------------------
For notational convenience, we introduce the following matrices.
%
\begin{equation}\label{4.3}
    \mat{X} =
    \begin{bmatrix}
        x_1^2  & y_1^2  & x_1y_1 & x_1    & y_1    & 1 \\
        x_2^2  & y_2^2  & x_2y_2 & x_2    & y_2    & 1 \\
        \vdots & \vdots & \vdots & \vdots & \vdots & \vdots \\
        x_N^2  & y_N^2  & x_Ny_N & x_N    & y_N    & 1
    \end{bmatrix}
    \qquad
    \mat{p} =
    \begin{bmatrix}
        a \\
        b \\
        \vdots \\
        f
    \end{bmatrix}
    \qquad
    \mat{z} =
    \begin{bmatrix}
        \hat{\phi}_1 \\
        \hat{\phi}_2 \\
        \vdots \\
        \hat{\phi}_N \\
    \end{bmatrix}
    \qquad
    \mat{e} =
    \begin{bmatrix}
        \epsilon_1 \\
        \epsilon_2 \\
        \vdots \\
        \epsilon_N \\
    \end{bmatrix}
\end{equation}
%
Using this notation, we can write \eqref{4.2} in the following compact form.
%
\begin{equation}\label{4.4}
    \mat{z} = \mat{X} \mat{p} + \mat{e}
\end{equation}

%------------------------------------------------------------------------------
\subsection{Mathematical Program}
%------------------------------------------------------------------------------


%==============================================================================
\section{FLOW DIRECTION}
%==============================================================================
%------------------------------------------------------------------------------
\subsection{A Convenient Choice}
%------------------------------------------------------------------------------
Without lose of generality, we assume that our location of interest is at the origin, $(x,y) = (0,0)$.  Applying \eqref{2.11} the flow direction at our location of interest becomes
%
\begin{align}\label{5.1}
    \alpha = \alpha(0,0)
    &= \text{\tt atan2}\left((2B \cdot 0 + C \cdot 0 + E), (2A \cdot 0 + C \cdot 0 + D)\right) \nonumber\\
    &= \text{\tt atan2}\left(E, D\right) \nonumber\\
    &= \text{\tt atan2}\left(e, d\right)
\end{align}
%
This last step is possible because the hydraulic conductivity, $k~[m]$, and the aquifer thickness, $H~[m]$ are strictly positive numbers.

We may carry out our analysis in terms of heads and never need to consider the discharge potential.  Using unknown parameters $\{a, b, c, d, e, f \}$, the aquifer properties $k$ and $H$ will never need to explicitly enter into our computations.  In this simple confined model, we can infer flow directions without knowing $z_b$, $H$, $k$, or $k_v$. All we need is lots of data.

%------------------------------------------------------------------------------
\subsection{Flow Direction Probability Distribution}
%------------------------------------------------------------------------------
The flow direction is a function of $d$ and $e$ only, so we need to extract the associated bivariate marginal distribution from the multivariate distribution. For a multivariate normal distribution, this is a simple process of extracting the fourth and fifth row of the expected value matrix, \eqref{4.7}, and the fourth and fifth rows and columns of the variance matrix, \eqref{4.7} (e.g., \citet[Section 18.2, Theorem 3]{Roussas1973}). We use the following notation to denote these extracted rows and columns.
%
\begin{equation}\label{5.2}
    \mat{u} = \begin{bmatrix} \mu_{d} \\ \mu_{e} \end{bmatrix}
    \qquad \qquad
    \mat{S} = \begin{bmatrix} \sigma_{d}^2 & \sigma_{de} \\ \sigma_{de} & \sigma_{e}^2 \end{bmatrix}
\end{equation}
%
The resulting distribution of the flow direction, $\alpha$, follows Smith's distribution\footnote{Smith's distribution is also called the ``General Projected Normal distribution''. See, for example, \citet{Lark2014} and \citet{Hernandez2017}.} (\citet[Equation (4-11)]{Justus1978} or \citet[Equation (6)]{Carta2008}):
%
\begin{equation}\label{5.3}
	f(\alpha) =
    	\dfrac{\sqrt{|\mat{S}^{-1}|}}{\mat{r}^T \mat{S}^{-1} \mat{r}}
	\cdot \frac{1}{2\pi} \left[ 1 + \sqrt{2\pi} D \cdot \exp{\left(\onehalf D^2\right)} \cdot \mathcal{F}(D) \right]
	\exp{\left(-\onehalf \mat{u}^T \mat{S}^{-1} \mat{u} \right)}
\end{equation}
%
with
%
\begin{equation}\label{5.4}
	D = \frac{\mat{r}^T \mat{S}^{-1} \mat{u}}{\sqrt{\mat{r}^T \mat{S}^{-1} \mat{r} }}
    \qquad \qquad
    \mat{r} = \begin{bmatrix}\cos{\alpha} \\ \sin{\alpha}\end{bmatrix}
\end{equation}
%
and $\mathcal{F}$ denotes the standard normal cumulative distribution function.

Smith's distribution model is relatively uncommon in the literature on directional data analysis. The most common model is the von Mises distribution (\citet{Mardia1972} or \citet{Watson1983}). Nonetheless, in our case, Smith's is appropriate because we are not analyzing directional measurements. We are inferring the distribution of the flow directions from a quadratic fit to head measurements.


%==============================================================================
\section{NET RECHARGE}
%==============================================================================
Combining \eqref{2.12} and \eqref{4.2} we have
%
\begin{equation}\label{101}
    \frac{N}{kH} = -2(a + b)
\end{equation}
%
The associated variance is
%
\begin{equation}\label{102}
    \var{\frac{N}{kH}} = 4 \big( \var{a} + \var{b} + 2 \cov{a, b} \big)
\end{equation}


%==============================================================================
\section{SUMMARY}
%==============================================================================
\vspace{0.2in}
\tcbset{colback=red!10!white}
\begin{tcolorbox}
{\Large In this simple confined model, we can infer the flow directions without knowing $z_b$, $H$, $k$, or $k_v$. All we need is lots of data.}
\end{tcolorbox}


%==============================================================================
% Bibliography
%==============================================================================
\newpage
\bibliographystyle{ascelike}
\bibliography{Randal,Local}


%==============================================================================
% Appendices
%==============================================================================
\newpage
\appendix

%==============================================================================
\section{Conic Discharge Potential}\label{7.1}
%==============================================================================
%------------------------------------------------------------------------------
\subsection{Using real variables}
%------------------------------------------------------------------------------
%--------------------------------------
\subsubsection{Discharge potential}
%--------------------------------------
The {\em conic discharge potential} is given by
%
\begin{equation} \label{7.2}
\boxed{
    \Phi(x,y) = Ax^2 + By^2 + Cxy + Dx + Ey + F
}
\end{equation}
%
where the coefficient, $\left\{ A, B, C, D, E, F \right\}$, are real constants.

This form is called the {\em conic discharge potential} because the level-sets of $\Phi(x,y)$ are conic sections\footnote{See, for example, \citet{wiki:conic}.}.  If $C^2 < 4AB$ the contours are ellipses\footnote{This is the form of the discharge potential used in {\Oneka}.}, if $C^2 = 4AB$ the contours are parabolas, and if $C^2 > 4AB$ the contours are hyperbolas.

%--------------------------------------
\subsubsection{Discharge}
%--------------------------------------
The components of the associated discharge vector are
%
\begin{align}
    -Q_x(x,y) &= \pderiv{\Phi}{x} = 2Ax + Cy + D \label{7.3}\\
    -Q_y(x,y) &= \pderiv{\Phi}{y} = 2By + Cx + E \label{7.4}
\end{align}

%--------------------------------------
\subsubsection{Divergence}
%--------------------------------------
The divergence of the discharge is
%
\begin{equation}\label{7.5}
    \nabla^2 \Phi = 2(A+B)
\end{equation}

%------------------------------------------------------------------------------
\subsection{Using complex variables}
%------------------------------------------------------------------------------
%--------------------------------------
\subsubsection{Discharge potential}
%--------------------------------------
Let
%
\begin{equation}\label{7.6}
    z = x + iy
    \qquad\text{and}\qquad
    \bar{z} = x - iy
\end{equation}
%
then
%
\begin{equation}\label{7.7}
    x = \frac{z + \bar{z}}{2}
    \qquad\text{and}\qquad
    y = \frac{z - \bar{z}}{2i}
\end{equation}
%
Substituting \eqref{7.7} into \eqref{7.2} yields
%
\begin{equation}\label{7.8}
    \begin{split}&\Phi(z,\bar{z}) = \\
    &
    A\left(\frac{z+\bar{z}}{2}\right)^2 + B\left(\frac{z-\bar{z}}{2i}\right)^2 +
    C\left(\frac{z+\bar{z}}{2}\right)\left(\frac{z-\bar{z}}{2i}\right) +
    D\left(\frac{z+\bar{z}}{2}\right) + E\left(\frac{z-\bar{z}}{2i}\right) + F
    \end{split}
\end{equation}
%
Expanding out the products in \eqref{7.8} yields
%
\begin{equation}\label{7.9}
    \begin{split}&\Phi(z,\bar{z}) = \\
    &
    A\left(\frac{z^2+2z\bar{z}+\bar{z}^2}{4}\right) + B\left(\frac{z^2-2z\bar{z}+\bar{z}^2}{-4}\right) +
    C\left(\frac{z^2-\bar{z}^2}{4i}\right) +
    D\left(\frac{z+\bar{z}}{2}\right) + E\left(\frac{z-\bar{z}}{2i}\right) + F
    \end{split}
\end{equation}
%
Collecting like terms in \eqref{7.9} yields
%
\begin{equation}\label{7.10}
    \begin{split}&\Phi(z,\bar{z}) = \\
    &
    \left(\frac{A-B-Ci}{4}\right) z^2 +
    \left(\frac{A-B+Ci}{4}\right) \bar{z}^2 +
    \left(\frac{A+B}{2}\right) z\bar{z} +
    \left(\frac{D-Ei}{2}\right) z +
    \left(\frac{D+Ei}{2}\right) \bar{z} +
    F
    \end{split}
\end{equation}
%
We define two complex constants $\left\{ a, b \right\}$, and two real constants $\left\{ c, d \right\}$, as
%
\begin{align}
    a &= \frac{A-B-Ci}{4} \label{7.11}\\
    b &= \frac{D-Ei}{2} \label{7.12}\\
    c &= \frac{F}{2} \label{7.13}\\
    d &= \frac{A+B}{2} \label{7.14}
\end{align}
%
Substituting \eqref{7.11} through \eqref{7.14} into \eqref{7.10} yields
%
\begin{equation}\label{7.15}
\boxed{
    \Phi(z,\bar{z}) = \left( az^2 + bz + c \right) + \overline{\left(az^2 + bz + c\right)} + dz\bar{z}
}
\end{equation}
%
The level sets for $\Phi(z,\bar{z})$are conic sections. If $2 \abs{a} < \abs{d}$ the contours are ellipses, if $2\abs{a} = \abs{d}$ the contours are parabolas, and if $2\abs{a} > \abs{d}$ the contours are hyperbolas.

%--------------------------------------
\subsubsection{Discharge}
%--------------------------------------
The complex discharge, denoted $W$, is given by
%
\begin{equation}\label{7.16}
    W(z,\bar{z}) = Q_x - i Q_y = -2 \pderiv{\Phi}{z} = -2 \left( 2az + b + d\bar{z} \right)
\end{equation}

%--------------------------------------
\subsubsection{Divergence}
%--------------------------------------
The divergence of the discharge is given by
%
\begin{equation}\label{7.17}
    \nabla^2 \Phi = 4 \pqderiv{\Phi}{z}{\bar{z}} = 4d
\end{equation}


\newpage
%==============================================================================
\section{General Project Normal Distribution}\label{8.1}
%==============================================================================
As given by \citet[(1)]{Hernandez2017}, the probability density function for the general projected normal distribution is given by
%
\begin{equation}\label{8.1}
    f\left( \theta | \mat{u}, \mat{V} \right)
    = \left( \frac{1}{AD} \right) \exp{(-C/2)} \left[ 1 + E \frac{\Phi(E)}{\phi(E)} \right]
\end{equation}
%
where $\Phi()$ is the standard normal distribution function, $\phi()$ is the standard normal density function given by
%
\begin{equation}\label{8.2}
    \phi(E) = \frac{1}{\sqrt{2 \pi}} \exp{\left(-E^2/2\right)}
\end{equation}
%
and
%
\begin{align}
    \mat{r}^T &= \begin{bmatrix}\cos{\theta}, \sin{\theta} \end{bmatrix} \\
    A &= \mat{r}^T \mat{V}^{-1} \mat{r} \\
    B &= \mat{r}^T \mat{V}^{-1} \mat{u} \\
    C &= \mat{u}^T \mat{V}^{-1} \mat{u} \\
    D &= 2 \pi \sqrt{\abs{\mat{V}}} \\
    E &= \frac{B}{\sqrt{A}}
\end{align}
%
The term $\phi(E)$ goes to $0$ for even moderate values of $\abs{E}$, which causes serious computational problems. To ameliorate this problem, we refactor \eqref{8.1} as follows.
%
\begin{equation}\label{8.1}
    f\left( \theta | \mat{u}, \mat{V} \right)
    = \left( \frac{1}{AD} \right) \left[ \exp{(-C/2)} + E \Phi(E) \sqrt{2\pi \exp{(E^2 - C)}} \right]
\end{equation}


%==============================================================================
\end{document}
%==============================================================================
